<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if page.title %}{{ page.title }} - {% endif %}{{ site.title | default: "Site Title" }}</title>
    <link rel="stylesheet" href="{{ '/assets/css/style.css' | relative_url }}">
    <link rel="stylesheet" href="{{ '/assets/css/video-player.css' | relative_url }}">
    <link rel="icon" type="image/x-icon" href="{{ 'favicon.ico' | relative_url }}">
</head>
<body>
    <div class="app-container">
        {% include sidebar.html %}

        <div class="main-wrapper">
            <header class="top-header">
                <div class="container">
                    <button class="mobile-menu-toggle" aria-label="Toggle navigation menu">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                    <h1 class="site-title">{{ site.title }}</h1>
                </div>
            </header>

            <main class="site-content">
                <div class="container">
                    <div class="content">
                        <h1>{{ page.title }}</h1>
                        {% if page.description %}
                        <p><em>{{ page.description }}</em></p>
                        {% endif %}
                        {{ content }}
                    </div>

                    <div class="chunk-nav">
                        {% assign nav_structure = site.data.navigation %}
                        {% assign flat_nav = '' | split: '' %}

                        {% if nav_structure.home %}
                            {% assign flat_nav = flat_nav | push: nav_structure.home %}
                        {% endif %}

                        {% if nav_structure.featured %}
                            {% for feature in nav_structure.featured %}
                                {% assign flat_nav = flat_nav | push: feature %}
                            {% endfor %}
                        {% endif %}

                        {% if nav_structure.steps %}
                            {% for step in nav_structure.steps %}
                                {% assign flat_nav = flat_nav | push: step %}
                                {% if step.substeps %}
                                    {% for subitem in step.substeps %}
                                        {% assign flat_nav = flat_nav | push: subitem %}
                                    {% endfor %}
                                {% endif %}
                            {% endfor %}
                        {% endif %}

                        {% assign prev_page = nil %}
                        {% assign next_page = nil %}
                        {% assign current_index = nil %}
                        {% assign normalized_page_url = page.url %}

                        {% for nav_item in flat_nav %}
                            {% if nav_item.url and nav_item.url == normalized_page_url %}
                                {% assign current_index = forloop.index0 %}
                                {% break %}
                            {% endif %}
                        {% endfor %}

                        {% if current_index != nil %}
                            {% assign prev_index = current_index | minus: 1 %}
                            {% if prev_index >= 0 %}
                                {% assign prev_page = flat_nav[prev_index] %}
                            {% endif %}
                            {% assign next_index = current_index | plus: 1 %}
                            {% if next_index < flat_nav.size %}
                                {% assign next_page = flat_nav[next_index] %}
                            {% endif %}
                        {% endif %}

                        {% if prev_page %}
                        <a href="{{ prev_page.url | relative_url }}">← Previous: {{ prev_page.title | default: 'Previous' }}</a>
                        {% endif %}
                        {% if next_page %}
                        <a href="{{ next_page.url | relative_url }}">Next: {{ next_page.title | default: 'Next' }} →</a>
                        {% endif %}
                    </div>

                </div>
            </main>
        </div>
    </div>

    <footer class="site-footer">
        <div class="container">
            <p>&copy; {{ site.time | date: "%Y" }} {{ site.title }}. All rights reserved.</p>
        </div>
    </footer>

    <script src="https://assets.mediadelivery.net/playerjs/playerjs-latest.min.js"></script>
    <script src="{{ '/assets/js/video-player.js' | relative_url }}"></script>
    {% include sidebar-scripts.html %}
</body>
</html>
