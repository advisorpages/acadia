<script>
    document.addEventListener('DOMContentLoaded', function() {
        const sidebar = document.querySelector('.sidebar');
        if (!sidebar) {
            return;
        }

        const menuToggle = document.querySelector('.mobile-menu-toggle');

        if (menuToggle) {
            const overlay = document.createElement('div');
            overlay.className = 'mobile-overlay';
            document.body.appendChild(overlay);

            function toggleMenu() {
                sidebar.classList.toggle('active');
                menuToggle.classList.toggle('active');
                overlay.classList.toggle('active');
                document.body.style.overflow = sidebar.classList.contains('active') ? 'hidden' : '';
            }

            menuToggle.addEventListener('click', toggleMenu);
            overlay.addEventListener('click', toggleMenu);

            // Close menu when clicking outside on mobile
            document.addEventListener('click', function(e) {
                if (window.innerWidth <= 768 &&
                    !sidebar.contains(e.target) &&
                    !menuToggle.contains(e.target) &&
                    sidebar.classList.contains('active')) {
                    toggleMenu();
                }
            });

            // Handle window resize
            window.addEventListener('resize', function() {
                if (window.innerWidth > 768 && sidebar.classList.contains('active')) {
                    toggleMenu();
                }
            });
        }

        // Collapsible submenu functionality
        const submenuToggles = document.querySelectorAll('.submenu-toggle');

        submenuToggles.forEach(toggle => {
            const li = toggle.closest('.has-submenu');
            const submenu = li ? li.querySelector('.submenu') : null;
            if (!li || !submenu) {
                return;
            }

            const updateAria = () => {
                const expanded = !li.classList.contains('collapsed');
                toggle.setAttribute('aria-expanded', expanded);
            };

            updateAria();

            toggle.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();

                li.classList.toggle('collapsed');
                submenu.classList.toggle('collapsed');
                updateAria();
            });
        });

        // Auto-expand submenu if current page is in it
        const currentActiveLink = document.querySelector('.sidebar-nav a.active');
        if (currentActiveLink) {
            const parentSubmenu = currentActiveLink.closest('.submenu');
            if (parentSubmenu) {
                const parentLi = parentSubmenu.closest('.has-submenu');
                if (parentLi) {
                    parentLi.classList.remove('collapsed');
                    parentSubmenu.classList.remove('collapsed');
                    const parentToggle = parentLi.querySelector('.submenu-toggle');
                    if (parentToggle) {
                        parentToggle.setAttribute('aria-expanded', 'true');
                    }
                }
            }
        }
    });
</script>
