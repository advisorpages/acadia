{% capture base_path %}{% include base-path.html %}{% endcapture %}
{% assign base_path = base_path | strip %}
<aside class="sidebar">
    {% assign nav = site.data.navigation %}
    {% assign home_item = nav.home %}
    {% assign featured_items = nav.featured | default: empty %}
    {% assign step_items = nav.steps | default: empty %}
    {% assign resource_items = nav.resources | default: empty %}
    <nav class="sidebar-nav">
        {% if home_item %}
        <ul class="nav-list nav-home">
            <li class="nav-resource-item">
                <a href="{{ base_path }}{{ home_item.url }}"{% if page.url == home_item.url %} class="active"{% endif %}>
                    <span class="nav-resource-icon">{{ home_item.icon | default: 'ğŸ ' }}</span>
                    <span class="nav-title">{{ home_item.title }}</span>
                </a>
            </li>
        </ul>
        {% endif %}

        {% if featured_items and featured_items.size > 0 %}
        <ul class="nav-list nav-featured">
            {% for feature in featured_items %}
            <li class="nav-resource-item nav-feature-item">
                <a href="{{ base_path }}{{ feature.url }}"{% if page.url == feature.url %} class="active"{% endif %}>
                    <span class="nav-resource-icon">{{ feature.icon | default: feature.badge | default: 'â˜…' }}</span>
                    <span class="nav-title">{{ feature.title }}</span>
                </a>
            </li>
            {% endfor %}
        </ul>
        {% endif %}

        {% if step_items and step_items.size > 0 %}
        <div class="nav-divider-top"></div>
        <div class="nav-steps">Steps</div>
        <ul class="nav-list nav-steps-list">
            {% assign step_index = 0 %}
            {% for step in step_items %}
            {% assign step_index = step_index | plus: 1 %}
            {% assign has_substeps = step.substeps and step.substeps.size > 0 %}
            <li{% if has_substeps %} class="has-submenu collapsed"{% endif %}>
                <a href="{{ base_path }}{{ step.url }}"{% if page.url == step.url %} class="active"{% endif %}>
                    <span class="nav-step">{{ step_index }}</span>
                    <span class="nav-title">{{ step.title }}</span>
                </a>
                {% if has_substeps %}
                <button class="submenu-toggle" type="button" aria-label="Toggle submenu"></button>
                <ul class="submenu collapsed">
                    {% for substep in step.substeps %}
                    <li>
                        <a href="{{ base_path }}{{ substep.url }}"{% if page.url == substep.url %} class="active"{% endif %}>
                            <span class="nav-title">{{ substep.title }}</span>
                        </a>
                    </li>
                    {% endfor %}
                </ul>
                {% endif %}
            </li>
            {% endfor %}
        </ul>
        {% endif %}

        {% if resource_items and resource_items.size > 0 %}
        <div class="nav-divider"></div>
        <div class="nav-resources">Resources</div>
        <ul class="nav-list nav-resources-list">
            {% for resource in resource_items %}
            <li class="nav-resource-item">
                <a href="{{ base_path }}{{ resource.url }}"{% if page.url == resource.url %} class="active"{% endif %}>
                    <span class="nav-resource-icon">{{ resource.icon | default: 'â€¢' }}</span>
                    <span class="nav-title">{{ resource.title }}</span>
                </a>
            </li>
            {% endfor %}
        </ul>
        {% endif %}
    </nav>
</aside>
